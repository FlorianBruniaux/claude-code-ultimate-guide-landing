---
import Layout from '../../layouts/Layout.astro'
import { DIAGRAM_THEMES } from '../../data/diagrams-data'
import { DIAGRAM_GUIDE_URLS } from '../../data/diagrams-guide-urls'

const title = 'Claude Code Diagrams: 40 Architecture & Workflow Visuals'
const description = '40 Mermaid diagrams covering Claude Code architecture, MCP ecosystem, multi-agent patterns, security, and workflows. Rendered as SVG at build time.'

const totalDiagrams = DIAGRAM_THEMES.reduce((sum, t) => sum + t.diagrams.length, 0)
const totalWithSVG = DIAGRAM_THEMES.reduce((sum, t) => sum + t.diagrams.filter(d => d.svg).length, 0)

const jsonLd = [
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": title,
    "description": description,
    "url": "https://cc.bruniaux.com/diagrams/",
    "datePublished": "2026-02-22",
    "dateModified": "2026-02-22",
    "inLanguage": "en-US",
    "isPartOf": {
      "@type": "WebSite",
      "@id": "https://cc.bruniaux.com/#website"
    },
    "author": {
      "@type": "Person",
      "name": "Florian BRUNIAUX",
      "url": "https://github.com/FlorianBruniaux"
    },
    "speakable": {
      "@type": "SpeakableSpecification",
      "cssSelector": ["h1", ".hero-subtitle", ".diagrams-hero-stats"]
    }
  },
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "What are Claude Code architecture diagrams?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Claude Code architecture diagrams are 40 Mermaid flowcharts covering 10 thematic areas: foundations, context management, configuration, architecture internals, MCP ecosystem, development workflows, multi-agent patterns, security, cost optimization, and adoption. Each diagram includes an ASCII text fallback."
        }
      },
      {
        "@type": "Question",
        "name": "What topics do the Claude Code diagrams cover?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "The 40 diagrams span 10 themes: Foundations (4-layer model, permission modes), Context & Sessions (memory hierarchy, session continuity), Configuration (precedence system, hooks pipeline), Architecture Internals (master loop, tool categories), MCP Ecosystem (server map, security threats), Development Workflows (TDD, spec-first, plan-driven), Multi-Agent Patterns (orchestration topologies, git worktrees), Security & Production (3-layer defense, CI/CD), Cost & Optimization (model selection, token strategies), and Adoption & Learning (onboarding paths, UVAL protocol)."
        }
      },
      {
        "@type": "Question",
        "name": "Are these Claude Code diagrams free to use?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes. All diagrams are open-source under the CC BY-SA 4.0 license, published in the Claude Code Ultimate Guide repository on GitHub. You can use, adapt, and redistribute them with attribution."
        }
      },
      {
        "@type": "Question",
        "name": "How are the Claude Code diagrams rendered?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "The diagrams are rendered as SVG at build time using mermaid-cli (mmdc). This means zero client-side JavaScript, no layout shift (CLS = 0), and instant display. Each diagram also has a plain-text ASCII fallback for accessibility."
        }
      },
      {
        "@type": "Question",
        "name": "Where can I find the Claude Code diagram source files?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Source files are in the guide/diagrams/ directory of the Claude Code Ultimate Guide repository on GitHub: github.com/FlorianBruniaux/claude-code-ultimate-guide/tree/main/guide/diagrams. Each .md file contains Mermaid syntax, an ASCII fallback, and a reference to the relevant guide section."
        }
      }
    ]
  }
]
---

<Layout title={title} description={description} jsonLd={jsonLd}>
  <!-- Page Hero -->
  <header class="page-hero">
    <div class="container">
      <nav class="breadcrumb" aria-label="Breadcrumb">
        <a href="/">Home</a>
        <span aria-hidden="true">â€º</span>
        <span>Diagrams</span>
      </nav>
      <h1>Claude Code: 40 Architecture Diagrams</h1>
      <p class="hero-subtitle">Visual reference for Claude Code internals â€” architecture, MCP ecosystem, multi-agent patterns, security models, and development workflows. 38 SVGs rendered at build time, zero client JavaScript.</p>
      <div class="diagrams-hero-stats">
        <div class="hero-stat">
          <span class="hero-stat-value">{totalDiagrams}</span>
          <span class="hero-stat-label">Diagrams</span>
        </div>
        <div class="hero-stat">
          <span class="hero-stat-value">{DIAGRAM_THEMES.length}</span>
          <span class="hero-stat-label">Themes</span>
        </div>
        <div class="hero-stat">
          <span class="hero-stat-value">SVG</span>
          <span class="hero-stat-label">Inline rendering</span>
        </div>
      </div>
    </div>
  </header>

  <!-- Theme navigation pills -->
  {DIAGRAM_THEMES.length > 0 && (
    <nav class="diagrams-nav" aria-label="Diagram themes">
      <div class="diagrams-nav-wrapper">
        <button class="diagrams-nav-arrow diagrams-nav-arrow--left" aria-label="Scroll left" id="nav-arrow-left">â€¹</button>
        <div class="diagrams-nav-inner" id="diagrams-nav-inner">
          {DIAGRAM_THEMES.map(t => (
            <a href={`#${t.id}`} class="diagrams-nav-pill">
              <span aria-hidden="true">{t.icon}</span>
              {t.title.replace(' Diagrams', '')}
            </a>
          ))}
        </div>
        <button class="diagrams-nav-arrow diagrams-nav-arrow--right" aria-label="Scroll right" id="nav-arrow-right">â€º</button>
      </div>
    </nav>
  )}

  <!-- Diagram themes -->
  <div class="container diagrams-content">
    {DIAGRAM_THEMES.length === 0 ? (
      <div class="diagrams-empty">
        <p>Diagrams are generated at build time from the <a href="https://github.com/FlorianBruniaux/claude-code-ultimate-guide/tree/main/guide/diagrams" target="_blank" rel="noopener">guide repository</a>.</p>
        <p>Run <code>node scripts/build-diagrams-data.mjs</code> to generate them locally.</p>
      </div>
    ) : (
      DIAGRAM_THEMES.map((theme, i) => (
        <details class="diagram-theme-details" id={theme.id} open={i === 0}>
          <summary class="diagram-theme-summary">
            <span class="diagram-theme-icon" aria-hidden="true">{theme.icon}</span>
            <span class="diagram-theme-title">{theme.title.replace(' Diagrams', '')}</span>
            <span class="diagram-theme-count">{theme.diagrams.length} diagram{theme.diagrams.length !== 1 ? 's' : ''}</span>
          </summary>
          <div class="diagram-theme-content">
            {theme.description && (
              <p class="diagram-theme-desc">{theme.description}</p>
            )}
            {theme.diagrams.map((d, i) => (
              <article class="diagram-entry">
                <h3 class="diagram-entry-title">{d.title}</h3>
                {d.description && (
                  <p class="diagram-entry-desc">{d.description}</p>
                )}
                <div
                  class="diagram-container"
                  data-guide-url={d.svg ? (DIAGRAM_GUIDE_URLS[theme.id]?.[i] ?? undefined) : undefined}
                  title={d.svg && DIAGRAM_GUIDE_URLS[theme.id]?.[i] ? 'Click to view this section in the guide' : undefined}
                >
                  {d.svg ? (
                    <Fragment set:html={d.svg} />
                  ) : (
                    <pre class="diagram-ascii" aria-label={`ASCII diagram: ${d.title}`}>{d.asciiFallback}</pre>
                  )}
                </div>
                {d.sourceRef && (
                  <p class="diagram-source">{d.sourceRef}</p>
                )}
              </article>
            ))}
          </div>
        </details>
      ))
    )}
  </div>

  <!-- FAQ Section (GEO: FAQPage schema) -->
  <div class="container diagrams-faq">
    <h2>Frequently Asked Questions</h2>
    <dl class="faq-list">
      <div class="faq-item">
        <dt>What topics do the diagrams cover?</dt>
        <dd>10 thematic areas: Foundations (4-layer model, permission modes), Context &amp; Sessions (memory hierarchy), Configuration (precedence, hooks), Architecture Internals (master loop, tool categories), MCP Ecosystem (server map, rug pull attack chain), Development Workflows (TDD, spec-first, plan-driven), Multi-Agent Patterns (orchestration topologies, git worktrees), Security &amp; Production (3-layer defense, CI/CD pipeline), Cost &amp; Optimization (model selection, token strategies), and Adoption &amp; Learning (onboarding paths, UVAL protocol).</dd>
      </div>
      <div class="faq-item">
        <dt>Are these diagrams free to use?</dt>
        <dd>Yes â€” open-source under <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">CC BY-SA 4.0</a>. Use, adapt, and redistribute with attribution.</dd>
      </div>
      <div class="faq-item">
        <dt>How are the SVGs generated?</dt>
        <dd>At build time using <code>mermaid-cli</code> (<code>mmdc</code>) with a neutral theme and transparent background. Zero client-side JavaScript â€” diagrams load instantly with no layout shift.</dd>
      </div>
      <div class="faq-item">
        <dt>Where are the source files?</dt>
        <dd>In <a href="https://github.com/FlorianBruniaux/claude-code-ultimate-guide/tree/main/guide/diagrams" target="_blank" rel="noopener"><code>guide/diagrams/</code> on GitHub</a>. Each <code>.md</code> file contains Mermaid syntax, an ASCII fallback, and a reference to the relevant guide section.</dd>
      </div>
    </dl>
  </div>

  <!-- Footer CTAs -->
  <div class="container diagrams-footer">
    <a href="https://github.com/FlorianBruniaux/claude-code-ultimate-guide/tree/main/guide/diagrams" class="btn btn-secondary" target="_blank" rel="noopener">View source on GitHub &rarr;</a>
    <a href="/" class="btn btn-ghost">&larr; Back to guide</a>
  </div>
</Layout>

<style>
/* â”€â”€â”€ Hero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.page-hero {
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border);
  padding: var(--space-3xl) 0 var(--space-2xl);
}

.breadcrumb {
  display: flex;
  gap: var(--space-sm);
  align-items: center;
  font-size: 0.85rem;
  color: var(--text-muted);
  margin-bottom: var(--space-lg);
}

.breadcrumb a {
  color: var(--text-secondary);
  text-decoration: none;
}

.breadcrumb a:hover {
  color: var(--accent);
}

.page-hero h1 {
  font-size: clamp(1.75rem, 4vw, 2.5rem);
  font-weight: 800;
  margin-bottom: var(--space-md);
  color: var(--text-primary);
}

.hero-subtitle {
  font-size: 1.05rem;
  color: var(--text-secondary);
  max-width: 640px;
  margin-bottom: var(--space-2xl);
}

.diagrams-hero-stats {
  display: flex;
  gap: var(--space-2xl);
  flex-wrap: wrap;
}

.hero-stat {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.hero-stat-value {
  font-size: 2rem;
  font-weight: 800;
  font-variant-numeric: tabular-nums;
  color: var(--accent);
  line-height: 1;
}

.hero-stat-label {
  font-size: 0.8rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

/* â”€â”€â”€ Navigation pills â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.diagrams-nav {
  position: sticky;
  top: 0;
  z-index: 10;
  background: var(--bg-primary);
  border-bottom: 1px solid var(--border);
  padding: var(--space-sm) 0;
}

.diagrams-nav-wrapper {
  max-width: var(--container-width, 1200px);
  margin: 0 auto;
  padding: 0 var(--space-sm);
  display: flex;
  align-items: center;
  gap: 4px;
  position: relative;
}

.diagrams-nav-arrow {
  flex-shrink: 0;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: var(--border-radius-full, 999px);
  color: var(--text-secondary);
  font-size: 1.3rem;
  cursor: pointer;
  transition: border-color 0.15s, color 0.15s, opacity 0.15s;
  line-height: 1;
  padding: 0;
  z-index: 1;
}

.diagrams-nav-arrow:hover {
  border-color: var(--accent);
  color: var(--accent);
}

.diagrams-nav-arrow:disabled,
.diagrams-nav-arrow[data-hidden="true"] {
  opacity: 0.3;
  cursor: default;
  pointer-events: none;
}

.diagrams-nav-inner {
  flex: 1;
  display: flex;
  gap: var(--space-sm);
  overflow-x: auto;
  scrollbar-width: none;
  padding: 0 var(--space-xs);
}

.diagrams-nav-inner::-webkit-scrollbar {
  display: none;
}

.diagrams-nav-pill {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  padding: var(--space-xs) var(--space-md);
  border-radius: var(--border-radius-full, 999px);
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  color: var(--text-secondary);
  text-decoration: none;
  font-size: 0.85rem;
  white-space: nowrap;
  transition: border-color 0.15s, color 0.15s, background 0.15s;
}

.diagrams-nav-pill:hover {
  border-color: var(--accent);
  color: var(--accent);
  background: var(--bg-accent-subtle, var(--bg-secondary));
}

/* â”€â”€â”€ Diagrams content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.diagrams-content {
  padding-top: var(--space-2xl);
  padding-bottom: var(--space-2xl);
}

.diagrams-empty {
  text-align: center;
  padding: var(--space-3xl) 0;
  color: var(--text-secondary);
}

.diagrams-empty code {
  background: var(--bg-secondary);
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 0.9em;
}

/* â”€â”€â”€ Theme details accordion â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.diagram-theme-details {
  border: 1px solid var(--border);
  border-radius: var(--border-radius-lg);
  margin-bottom: var(--space-lg);
  background: var(--bg-secondary);
  overflow: hidden;
}

.diagram-theme-summary {
  display: flex;
  align-items: center;
  gap: var(--space-md);
  padding: var(--space-lg) var(--space-xl);
  cursor: pointer;
  list-style: none;
  user-select: none;
  transition: background 0.15s;
}

.diagram-theme-summary::-webkit-details-marker {
  display: none;
}

.diagram-theme-summary:hover {
  background: var(--bg-tertiary, var(--bg-secondary));
}

.diagram-theme-details[open] .diagram-theme-summary {
  border-bottom: 1px solid var(--border);
}

.diagram-theme-icon {
  font-size: 1.4rem;
  line-height: 1;
  flex-shrink: 0;
}

.diagram-theme-title {
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--text-primary);
  flex: 1;
}

.diagram-theme-count {
  font-size: 0.8rem;
  color: var(--text-muted);
  background: var(--bg-tertiary, rgba(0,0,0,0.05));
  padding: 2px 8px;
  border-radius: var(--border-radius-full, 999px);
  border: 1px solid var(--border);
}

/* Expand/collapse indicator */
.diagram-theme-summary::after {
  content: 'â€º';
  font-size: 1.2rem;
  color: var(--text-muted);
  transition: transform 0.2s;
  margin-left: auto;
}

.diagram-theme-details[open] .diagram-theme-summary::after {
  transform: rotate(90deg);
}

.diagram-theme-content {
  padding: 0 var(--space-xl) var(--space-xl);
}

.diagram-theme-desc {
  color: var(--text-secondary);
  font-size: 0.95rem;
  padding-top: var(--space-lg);
  margin-bottom: var(--space-xl);
  border-bottom: 1px solid var(--border);
  padding-bottom: var(--space-xl);
}

/* â”€â”€â”€ Individual diagram entry â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.diagram-entry {
  padding: var(--space-xl) 0;
  border-bottom: 1px solid var(--border);
}

.diagram-entry:last-child {
  border-bottom: none;
  padding-bottom: 0;
}

.diagram-entry-title {
  font-size: 1rem;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: var(--space-sm);
}

.diagram-entry-desc {
  color: var(--text-secondary);
  font-size: 0.9rem;
  margin-bottom: var(--space-lg);
  max-width: 640px;
}

/* â”€â”€â”€ Diagram container (SVG + ASCII) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.diagram-container {
  overflow-x: auto;
  margin: var(--space-lg) 0;
  padding: var(--space-lg);
  background: var(--bg-primary);
  border-radius: var(--border-radius);
  border: 1px solid var(--border);
  position: relative;
}

/* Nodes in clickable diagrams: pointer cursor + brightness on hover */
.diagram-container[data-guide-url] :global(svg .node) {
  cursor: pointer;
}

.diagram-container[data-guide-url] :global(svg .node rect),
.diagram-container[data-guide-url] :global(svg .node circle),
.diagram-container[data-guide-url] :global(svg .node polygon),
.diagram-container[data-guide-url] :global(svg .node path) {
  transition: filter 0.15s;
}

.diagram-container[data-guide-url] :global(svg .node:hover rect),
.diagram-container[data-guide-url] :global(svg .node:hover circle),
.diagram-container[data-guide-url] :global(svg .node:hover polygon),
.diagram-container[data-guide-url] :global(svg .node:hover path) {
  filter: brightness(1.2);
}

/* â”€â”€â”€ Guide tooltip â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.diagram-guide-tooltip {
  position: fixed;
  z-index: 200;
  background: var(--bg-secondary, #1e1e1e);
  border: 1px solid var(--accent, #E87E2F);
  border-radius: 8px;
  padding: 10px 14px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.35);
  pointer-events: none;
  opacity: 0;
  transform: translateY(6px);
  transition: opacity 0.15s, transform 0.15s;
  display: flex;
  align-items: center;
  gap: 10px;
  white-space: nowrap;
}

.diagram-guide-tooltip.is-visible {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

.diagram-guide-tooltip-link {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--accent, #E87E2F);
  text-decoration: none;
  padding: 3px 9px;
  border: 1px solid var(--accent, #E87E2F);
  border-radius: 4px;
  transition: background 0.12s, color 0.12s;
}

.diagram-guide-tooltip-link:hover {
  background: var(--accent, #E87E2F);
  color: #fff;
}

.diagram-container :global(svg.diagram-svg) {
  max-width: 100%;
  height: auto;
  display: block;
}

/* Dark mode adjustments for SVG edges/labels */
[data-theme="dark"] .diagram-container :global(.edgePath path),
[data-theme="dark"] .diagram-container :global(.edge path) {
  stroke: #888;
}

[data-theme="dark"] .diagram-container :global(.edgeLabel) {
  color: #ccc;
}

[data-theme="dark"] .diagram-container :global(.cluster rect) {
  stroke: #555;
  fill: #1a1a1a;
}

.diagram-ascii {
  font-size: 0.78rem;
  line-height: 1.5;
  color: var(--text-secondary);
  white-space: pre;
  overflow-x: auto;
  margin: 0;
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
}

.diagram-source {
  font-size: 0.8rem;
  color: var(--text-muted);
  margin-top: var(--space-sm);
  margin-bottom: 0;
}

/* â”€â”€â”€ FAQ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.diagrams-faq {
  padding-top: var(--space-3xl);
  padding-bottom: var(--space-2xl);
  border-top: 1px solid var(--border);
  margin-top: var(--space-2xl);
}

.diagrams-faq h2 {
  font-size: 1.3rem;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: var(--space-xl);
}

.faq-list {
  display: flex;
  flex-direction: column;
  gap: var(--space-xl);
}

.faq-item dt {
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: var(--space-sm);
}

.faq-item dd {
  color: var(--text-secondary);
  font-size: 0.93rem;
  line-height: 1.65;
  margin-left: 0;
}

.faq-item dd code {
  background: var(--bg-secondary);
  padding: 1px 5px;
  border-radius: 3px;
  font-size: 0.88em;
}

/* â”€â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.diagrams-footer {
  display: flex;
  gap: var(--space-md);
  padding-bottom: var(--space-3xl);
  flex-wrap: wrap;
}

.btn-ghost {
  display: inline-flex;
  align-items: center;
  padding: var(--space-sm) var(--space-lg);
  border-radius: var(--border-radius);
  color: var(--text-secondary);
  text-decoration: none;
  font-size: 0.9rem;
  transition: color 0.15s;
}

.btn-ghost:hover {
  color: var(--text-primary);
}

/* â”€â”€â”€ Mobile â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 480px) {
  .diagrams-nav-arrow {
    width: 28px;
    height: 28px;
    font-size: 1.1rem;
  }
}

@media (max-width: 640px) {
  .page-hero {
    padding: var(--space-2xl) 0 var(--space-xl);
  }

  .diagram-theme-summary {
    padding: var(--space-md) var(--space-lg);
  }

  .diagram-theme-content {
    padding: 0 var(--space-lg) var(--space-lg);
  }

  .diagram-container {
    padding: var(--space-md);
    margin: var(--space-md) 0;
  }

  .diagrams-footer {
    flex-direction: column;
  }
}
</style>

<script>
  // â”€â”€ Per-node tooltip with guide link â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const tooltip = document.createElement('div')
  tooltip.className = 'diagram-guide-tooltip'
  tooltip.innerHTML = `ðŸ“– <a class="diagram-guide-tooltip-link" target="_blank" rel="noopener noreferrer">View in guide â†’</a>`
  document.body.appendChild(tooltip)

  const tooltipLink = tooltip.querySelector<HTMLAnchorElement>('.diagram-guide-tooltip-link')!
  let hideTimer: ReturnType<typeof setTimeout>

  function showTooltip(url: string, anchorEl: Element) {
    clearTimeout(hideTimer)
    tooltipLink.href = url
    tooltip.classList.add('is-visible')
    positionTooltip(anchorEl)
  }

  function hideTooltip() {
    hideTimer = setTimeout(() => tooltip.classList.remove('is-visible'), 200)
  }

  function positionTooltip(el: Element) {
    const rect = el.getBoundingClientRect()
    const tw = tooltip.offsetWidth || 220
    const th = tooltip.offsetHeight || 44
    const margin = 8
    let left = rect.left + rect.width / 2 - tw / 2
    let top = rect.top - th - margin
    // flip below if no room above
    if (top < margin) top = rect.bottom + margin
    // clamp horizontally
    left = Math.max(margin, Math.min(left, window.innerWidth - tw - margin))
    tooltip.style.left = `${left}px`
    tooltip.style.top = `${top}px`
  }

  // Keep tooltip open when hovering it
  tooltip.addEventListener('mouseenter', () => clearTimeout(hideTimer))
  tooltip.addEventListener('mouseleave', hideTooltip)

  const containers = document.querySelectorAll<HTMLElement>('.diagram-container[data-guide-url]')
  console.log('[diagrams] containers with data-guide-url:', containers.length)

  containers.forEach((container, ci) => {
    const url = container.dataset.guideUrl!
    // Try multiple selectors â€” Mermaid SVG structure varies by version
    const nodes = container.querySelectorAll<SVGGElement>('svg .node, svg g[id^="flowchart-"]')
    console.log(`[diagrams] container #${ci} url=${url} nodes found:`, nodes.length)
    if (nodes.length === 0) {
      // Log actual SVG structure for debugging
      const svg = container.querySelector('svg')
      if (svg) {
        const gElements = svg.querySelectorAll('g')
        console.log(`[diagrams] container #${ci} total <g> elements:`, gElements.length)
        gElements.forEach((g, i) => {
          if (i < 10) console.log(`  g[${i}] id="${g.id}" class="${g.className?.baseVal}"`)
        })
      }
    }
    nodes.forEach(node => {
      node.addEventListener('mouseenter', () => showTooltip(url, node))
      node.addEventListener('mouseleave', hideTooltip)
      node.addEventListener('click', (e) => {
        e.stopPropagation()
        showTooltip(url, node)
      })
    })
  })

  // â”€â”€ Nav arrows â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const inner = document.getElementById('diagrams-nav-inner')
  const btnLeft = document.getElementById('nav-arrow-left')
  const btnRight = document.getElementById('nav-arrow-right')

  if (inner && btnLeft && btnRight) {
    const SCROLL_AMOUNT = 240

    function updateArrows() {
      const atStart = inner.scrollLeft <= 4
      const atEnd = inner.scrollLeft >= inner.scrollWidth - inner.clientWidth - 4
      btnLeft.dataset.hidden = atStart ? 'true' : 'false'
      btnRight.dataset.hidden = atEnd ? 'true' : 'false'
    }

    btnLeft.addEventListener('click', () => {
      inner.scrollBy({ left: -SCROLL_AMOUNT, behavior: 'smooth' })
    })

    btnRight.addEventListener('click', () => {
      inner.scrollBy({ left: SCROLL_AMOUNT, behavior: 'smooth' })
    })

    inner.addEventListener('scroll', updateArrows, { passive: true })
    updateArrows()
  }
</script>
